var controller={init:function(){data.activeMarkers=[];view.header(data.pageHeader.main,data.pageHeader.sub);closeNav();this.createMap();this.createMarkers();this.addMarkerFousquareData();view.displayFilterControls(data.filterButtons);ko.options.useOnlyNativeEvents=!0;ko.applyBindings(view)},createMap:function(){data.map=new google.maps.Map(document.getElementById('map'),{center:data.mapCenter,zoom:data.mapDefaultZoom,mapTypeId:'terrain',mapTypeControlStyle:'dropdown_menu'});var trafficLayer=new google.maps.TrafficLayer();trafficLayer.setMap(data.map)},createMarkers:function(){var loopStop=data.arrMarkerInput.length;for(loop=0;loop<loopStop;loop++){marker=new google.maps.Marker({position:data.arrMarkerInput[loop].position,map:data.map,icon:'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld='+(loop+1)+'|FF9900',title:data.arrMarkerInput[loop].title,listed:ko.observable(!0),animation:google.maps.Animation.DROP,inputCategory:data.arrMarkerInput[loop].type,fsCategory:ko.observable(null),fsName:ko.observable(),fsID:data.arrMarkerInput[loop].fsID,fsPhone:ko.observable('No listing in Foursquare'),fsAddress:ko.observable(),fsUrl:ko.observable('#'),fsRating:ko.observable(null),number:(loop+1),hasDetails:ko.observable(!1)});data.activeMarkers.push(marker)}},addMarkerFousquareData:function(){var fsSuccess,fsError;var loopStop=data.activeMarkers.length;for(loop=0;loop<loopStop;loop++){if(data.activeMarkers[loop].fsID===undefined){controller.addMarkerInfoWindow(loop)}else{strFsqURL=data.fsAPIBaseURL.replace('%replace%',data.activeMarkers[loop].fsID);this.foursquareData(loop,strFsqURL,fsSuccess,fsError)}}},addMarkerInfoWindow:function(int){var intID;google.maps.event.addListener(data.activeMarkers[int],'click',function(){infoWindowContentString='<div><div class="iwTitle"><pre>'+this.title+'\t'+data.activeMarkers[int].inputCategory;if(this.fsRating()===null){infoWindowContentString=infoWindowContentString+'</div></div>'}else{infoWindowContentString=infoWindowContentString+' ('+data.activeMarkers[int].fsCategory()+')\t'+this.fsRating()+'</pre><p>'+this.fsPhone()+'</p><p>'+this.fsAddress()+'</p><a href="'+this.fsUrl()+'">Foursquare site</a></div></div>'}
intID=int+1;controller.listItemExpand(int+1);infoWindow=new google.maps.InfoWindow({content:infoWindowContentString});infoWindow.open(data.map,this)})},filterMarkers:function(filter){var loopStop=data.activeMarkers.length;for(var loop=0;loop<loopStop;loop++){if(filter==data.activeMarkers[loop].inputCategory||filter=="All"||filter==data.activeMarkers[loop].title||filter==data.activeMarkers[loop].number){data.activeMarkers[loop].listed(!0);data.activeMarkers[loop].setMap(data.map);if(data.activeMarkers[loop].getAnimation()===1){}else{data.activeMarkers[loop].animation=google.maps.Animation.BOUNCE}}else{data.activeMarkers[loop].listed(!1);data.activeMarkers[loop].setMap(null)}}},filterMarkersKO:function(){},selectedMarker:data.selectedMarker.subscribe(function(newValue){if(typeof newValue!='undefined'){controller.filterMarkers(newValue.title)}else{controller.filterMarkers("All")}}),foursquareData:function(int,path,success,error){var xhr=new XMLHttpRequest();var fsJson,loopStop;var fsReturnData=ko.observableArray([]);xhr.onreadystatechange=function()
{if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status===200){if(success)
success(JSON.parse(xhr.responseText));fsJson=ko.utils.parseJson(xhr.responseText);if(fsJson.response.venue.id===data.activeMarkers[int].fsID){data.activeMarkers[int].fsCategory(fsJson.response.venue.categories[0].shortName);data.activeMarkers[int].fsPhone(fsJson.response.venue.contact.formattedPhone);data.activeMarkers[int].fsAddress(fsJson.response.venue.location.formattedAddress[0]+', '+fsJson.response.venue.location.formattedAddress[1]+', '+fsJson.response.venue.location.formattedAddress[2]);data.activeMarkers[int].fsUrl(fsJson.response.venue.canonicalUrl);data.activeMarkers[int].fsRating((fsJson.response.venue.rating*10)+'%');data.activeMarkers[int].hasDetails(!0)}else{console.log('There is an error with what marker the Foursqare data is for')}
controller.addMarkerInfoWindow(int)}else{if(error)
error(xhr);console.log('FoursquareData error = ')}}};xhr.open("GET",path,!0);xhr.send()},listItemExpand:function(input){var loopStop=data.activeMarkers.length;var turnOnOff;for(loop=0;loop<loopStop;loop++){if(input===data.activeMarkers[loop].number){turnOnOff=!0;controller.bounceOneMarker(loop)}else{turnOnOff=!1}
view.detailVisibility('detail-',loop+1,turnOnOff)}},bounceOneMarker(filter){var loopStop=data.activeMarkers.length;for(var loop=0;loop<loopStop;loop++){if(filter===data.activeMarkers[loop].number-1){if(data.activeMarkers[loop].getAnimation()===1){}else{data.activeMarkers[loop].setMap(null);data.activeMarkers[loop].animation=google.maps.Animation.BOUNCE;data.activeMarkers[loop].setMap(data.map)}}else{data.activeMarkers[loop].setMap(null);data.activeMarkers[loop].animation=null;data.activeMarkers[loop].setMap(data.map)}}}}
